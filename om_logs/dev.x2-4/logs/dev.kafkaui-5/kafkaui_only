#
# Generated by omcli
# Cluster:dev.x2-4 Node:dev.x2-4.kafkaui-1
#
cat << 'HOSTS' > omhosts
# Generated by omcli

192.168.10.11  dev.kafkaui-5
192.168.10.11  dev.x2-4.kafkaui-1.ctrl
192.168.104.1  dev.x2-4.kafkaui-1.ext
192.168.10.61  dev.kafkaw-04
192.168.10.61  dev.x2-4.kafkaw-1.ctrl
192.168.104.6  dev.x2-4.kafkaw-1.ext
192.168.10.71  dev.kafkaw-12
192.168.10.71  dev.x2-4.kafkaw-2.ctrl
192.168.104.7  dev.x2-4.kafkaw-2.ext
192.168.10.11  dev.rdpui-5
192.168.10.11  dev.x2-4.rdpui-1.ctrl
192.168.104.1  dev.x2-4.rdpui-1.ext
192.168.10.21  dev.x2-17
192.168.10.21  dev.x2-4.x2-0.ctrl
192.168.104.2  dev.x2-4.x2-0.ext
192.168.214.2  dev.x2-4.x2-0.ib
192.168.204.2  dev.x2-4.x2-0.int
192.168.10.31  dev.x2-18
192.168.10.31  dev.x2-4.x2-1.ctrl
192.168.104.3  dev.x2-4.x2-1.ext
192.168.214.3  dev.x2-4.x2-1.ib
192.168.204.3  dev.x2-4.x2-1.int
192.168.10.41  dev.x2-19
192.168.10.41  dev.x2-4.x2-2.ctrl
192.168.104.4  dev.x2-4.x2-2.ext
192.168.214.4  dev.x2-4.x2-2.ib
192.168.204.4  dev.x2-4.x2-2.int
192.168.10.51  dev.x2-20
192.168.10.51  dev.x2-4.x2-3.ctrl
192.168.104.5  dev.x2-4.x2-3.ext
192.168.214.5  dev.x2-4.x2-3.ib
192.168.204.5  dev.x2-4.x2-3.int
192.168.10.11  dev.x2w-08
192.168.10.11  dev.x2-4.x2w-1.ctrl
192.168.104.1  dev.x2-4.x2w-1.ext
HOSTS
cat omhosts | sudo tee /etc/hosts &> /dev/null
#!/usr/bin/env bash
#
cat << 'EOF' >application.yml
dynamic.config.enabled: true

spring:
  security:
    basic:
      enabled: false
#logging:
#   level:
     # root: DEBUG
     # com.provectus: DEBUG
     # reactor.netty.http.server.AccessLog: DEBUG
     # org.hibernate.validator: DEBUG

# logging:
#   level:
#     com.provectus: DEBUG
#     org.apache.kafka: DEBUG

logging:
   level:
     root: INFO
     com.provectus: DEBUG
     org.apache.kafka: DEBUG
     reactor.netty.http.server.AccessLog: INFO
     org.hibernate.validator: WARN
EOF
cat << 'EOF' >dynamic_config.yml
kafka:
  clusters:
  - bootstrapServers: dev.x2-4.x2-0.ext:1519
    name: dev.x2-4
    properties:
      security.protocol: PLAINTEXT
    readOnly: false
    ssl:
      truststoreLocation: dev.x2-4.kafkaui-1.truststore.jks
      truststorePassword: kafkatest
rbac:
  roles: []
webclient: {}
EOF
#
function start_kafkaui {
  echo "Starting kafkaui..."
  ln -sfr application.yml /etc/kafkaui/application.yml
  ln -sfr dynamic_config.yml /etc/kafkaui/dynamic_config.yaml
  nohup java --add-opens java.rmi/javax.rmi.ssl=ALL-UNNAMED -Dspring.config.additional-location=application.yml -jar kafka-ui-api.jar 2&>1 >kafkaui.log &
}
#
function stop_kafkaui {
  echo "Stopping kafkaui..."
  kill -9 $(pidof java) 2>/dev/null || { echo "====Was not running"; }
}
function status_kafkaui {
  echo "Checking kafkaui status..."
  lsof -i || { echo "====Not running"; }
}
#
echo "script:info  node:dev.kafkaui-5 omnode:dev.x2-4.kafkaui-1 option:$1 "
case $1 in
     start|start_clean)
     stop_kafkaui
     start_kafkaui
     ;;
     stop)
     stop_kafkaui
     ;;
     status)
     status_kafkaui
     ;;
     *)
     ;;
esac
