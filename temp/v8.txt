 ind_beg(kafka2::OffsetFetchRequest_groups_curs,req_group,req) {
            kafka2::OffsetFetchResponseGroup9a &rsp_group = groups_Alloc(rsp);
            rsp_group.group_id = req_group.group_id;
            FCgrp *gw_group = ind_cgrp_Find(req_group.group_id);
            bool stable = !req.require_stable || (gw_group && gw_group->state == kafka_GroupState_Stable);
            algo::ByteAry req_keys;
            // quick and dirty: reconstruct topics in request
            if (gw_group && !topics_N(req_group)) {
                ind_beg(cgrp_topic_curs,t,*gw_group) {
                    kafka2::OffsetFetchRequestTopics9q &req_topic = topics_Alloc(req_group);
                    req_topic.name = t;
                }ind_end;
            }
            ind_beg(kafka2::OffsetFetchRequestGroup9q_topics_curs,req_topic,req_group) {
                kafka2::OffsetFetchResponseTopics9a &rsp_topic = topics_Alloc(rsp_group);
                rsp_topic.name = req_topic.name;
                // quick and dirty: reconstruct partitions in request
                if (gw_group && !partition_indexes_N(req_topic)) {
                    if (x2gw::FTopic *gw_topic = ind_topic_Find(req_topic.name)) {
                        frep_(i,gw_topic->num_partitions) {
                            partition_indexes_Alloc(req_topic) = i;
                        }
                    }
                }
                ind_beg(kafka2::OffsetFetchRequestTopics9q_partition_indexes_curs,req_partition,req_topic) {
                    kafka2::OffsetFetchResponsePartitions9a &rsp_partition = partitions_Alloc(rsp_topic);
                    rsp_partition.partition_index = req_partition;
                    if (err) {
                        rsp_partition.error_code = err;
                    } else {
                        kafka::OffsetCommitKey key;
                        key.group = req_group.group_id;
                        key.topic = req_topic.name;
                        key.partition = req_partition;
                        algo::ByteAry buf;
                        lib_kafka::EncodeOffsetCommitKey(buf,key);
                        lib_x2::Key_FmtAppend(req_keys,ToStrPtr(ary_Getary(buf)));
                        if (!stable) {
                            err = kafka_Error_REBALANCE_IN_PROGRESS;
                        }
                    }
                }ind_end;
            }ind_end;
            if (ary_N(req_keys)) {
                x2gw::FProduce &produce = ProduceAlloc(*GetPartStream(consumer_offsets_stream), algo::CurrUnTime());
                lib_x2::QueryKeyMsg_FmtByteAry(produce.data, produce.request_id, consumer_offsets_stream->stream_id, lib_x2::_db.c_sysresp->stream_id, ams::ProcId(), algo::memptr());
                ary_Addary(produce.data, req_keys);
                ams::MsgHeader *out = (ams::MsgHeader*)produce.data.ary_elems;
                out->length = produce.data.ary_n;
                produce.waitdata=true;// don't delete after ack
                h_data_Set2(produce,produce,x2gw::OffsetFetch);
                produce.p_prodgrp = _db.cur_prodgrp;
                zd_produce_Insert(*_db.cur_prodgrp,produce); // manual xref
                produce.rsp_group_index = groups_N(rsp)-1;
                produce.op = x2gw_RespProduceOp_get;
                ProduceXref(produce);
            }
        }ind_end;